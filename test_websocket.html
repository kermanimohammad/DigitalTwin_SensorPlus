<!DOCTYPE html>
<html>
<head>
    <title>MQTT WebSocket Test</title>
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
</head>
<body>
    <h2>MQTT WebSocket Connection Test</h2>
    <div>
        <label>Host: <input id="host" value="ws://test.mosquitto.org:8080" size="40"></label><br><br>
        <label>Topic: <input id="topic" value="building/demo/#" size="20"></label><br><br>
        <button onclick="connect()">Connect</button>
        <button onclick="disconnect()">Disconnect</button>
        <button onclick="clearLog()">Clear</button>
    </div>
    <pre id="log" style="background:#000;color:#0f0;padding:10px;height:300px;overflow:auto;"></pre>

    <script>
        let client = null;
        const log = document.getElementById('log');
        
        function addLog(msg) {
            log.textContent += new Date().toLocaleTimeString() + ': ' + msg + '\n';
            log.scrollTop = log.scrollHeight;
        }
        
        function connect() {
            const host = document.getElementById('host').value;
            const topic = document.getElementById('topic').value;
            
            addLog('Connecting to ' + host + '...');
            
            try {
                client = mqtt.connect(host);
                
                client.on('connect', function () {
                    addLog('‚úÖ Connected successfully!');
                    client.subscribe(topic);
                    addLog('üì° Subscribed to: ' + topic);
                });
                
                client.on('message', function (topic, message) {
                    addLog('üì© ' + topic + ': ' + message.toString());
                });
                
                client.on('error', function (error) {
                    addLog('‚ùå Error: ' + error);
                });
                
                client.on('close', function () {
                    addLog('‚õî Connection closed');
                });
                
                client.on('reconnect', function () {
                    addLog('üîÑ Reconnecting...');
                });
                
            } catch (error) {
                addLog('‚ùå Connection failed: ' + error);
            }
        }
        
        function disconnect() {
            if (client) {
                client.end();
                addLog('Disconnected');
            }
        }
        
        function clearLog() {
            log.textContent = '';
        }
    </script>
</body>
</html>
