<!doctype html>
<html lang="fa" dir="rtl">
<meta charset="utf-8" />
<title>MQTT WS Test</title>
<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
<body style="font-family:system-ui; margin:24px">
  <h2>MQTT to WebSocket connection Test</h2>
  <div style="display:flex; gap:8px; flex-wrap:wrap; align-items:center">
    <label>Host (WS/WSS):
      <input id="host" value="wss://mqtt.eclipseprojects.io:8080" size="30">
    </label>
    <label>Topic:
      <input id="topic" value="building/demo/#" size="20">
    </label>
    <label>User:
      <input id="user" placeholder="Optional">
    </label>
    <label>Pass:
      <input id="pass" type="password" placeholder="Optional">
    </label>
    <button id="connect">Connection</button>
    <button id="clear">Clear Log</button>
  </div>

  <pre id="log" style="background:#0b1020;color:#a9f;border-radius:10px;padding:12px;margin-top:12px;max-height:60vh;overflow:auto"></pre>

  <script>
    const logEl = document.getElementById('log');
    const log = (...a) => { logEl.textContent += a.join(' ') + '\n'; logEl.scrollTop = logEl.scrollHeight; };

    document.getElementById('clear').onclick = ()=> logEl.textContent = '';

    document.getElementById('connect').onclick = () => {
      const url = document.getElementById('host').value.trim();
      const topic = document.getElementById('topic').value.trim();
      const username = document.getElementById('user').value.trim();
      const password = document.getElementById('pass').value;

      const opts = { keepalive: 30 };
      if (username) { opts.username = username; opts.password = password; }

      log('‚è≥ connecting to', url, '...');

      try {
        const client = mqtt.connect(url, opts);
        client.on('connect', () => { log('‚úÖ connected'); client.subscribe(topic); log('üì° subscribed:', topic); });
        client.on('message', (t, m) => log('üì©', t, m.toString()));
        client.on('reconnect', () => log('‚Üª reconnecting...'));
        client.on('error', (e) => log('‚ùå error:', (e && e.message) || e));
        client.on('close', () => log('‚õî connection closed'));
      } catch (e) {
        log('‚ùå failed to init:', e.message || e);
      }
    };
  </script>
</body>
</html>
